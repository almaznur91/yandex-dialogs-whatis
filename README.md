# yandex-dialogs-whatis

[![Build Status](https://travis-ci.org/popstas/yandex-dialogs-whatis.svg?branch=master)](https://travis-ci.org/popstas/yandex-dialogs-whatis)

Бот отвечает на вопросы и умеет записывать новые ответы.

У каждого пользователя собственная база вопросов и ответов.

По умолчанию запускается на *:2756

## Сценарии использования
Я посмотрел несколько дней, как люди используют навык и понял, что не хватает примеров использования. Почти все пытаются использовать навык как напоминалку: "завтра будет дождь" и т.д. она не будет так работать, но плохо, т.к. когда наступит завтра, для навыка запись не превратится в "сегодня". Опишу сценарии, для которых навык должен хорошо сработать.

1. "Виртуальные подписи". Изначально задумка была такая: у меня есть несколько бутыльков с жидкостями, подписывать я их не могу, так как содержимое периодически меняется. Поэтому я промаркировал их цветами. Вторая память в этом случае заменяет подписи на бутыльках, когда я меняю жидкость, говорю: "в красном налит арбуз". После этого я могу спросить "где арбуз" или "что в красном".

2. "Помощь мастеру". Если вам приходилось когда-нибудь разбирать технику или собирать девайсы на платформах типа Arduino или ESP, вы знаете, что собрать обратно бывает непросто, если не запоминать процесс разборки. Навык может помочь в простых случаях (в сложных проще сделать фотографии до разборки). Например, можно запоминать соответствия "пин - цвет": "в первом воткнут синий", а потом спросить при сборке: "где синий".

3. "Список покупок". Этот сценарий не проработан, для него лучше использовать навык "Мой список покупок", но в принципе он сработает и в чем-то он более человечно сработает. Главное условие: все продукты надо проговорить за один раз, например: "в магазине надо купить яйца, хлеб, молоко и кефир". Спросить можно так: "что в магазине".

4. "Расписание". Это может быть расписание пар в школе или меню в столовой. "в среду в школе будет математика, русский, черчение, физика" - "что будет в среду в школе", "в пятницу в столовой будут щи" - "что будет в пятницу в столовой".

5. "Показания счетчиков". Если вы передаёте показания счетчиков электричества или воды, вы знаете, что нужно либо запомнить несколько цифр, либо подходить с листочком. Со второй памятью это можно сделать так: "тариф 1 набежало 2568" - "что тариф 1", "холодная натекло 321" - "что холодная".

6. "Запомни номер". Бывают ситуации, когда надо записать номер телефона. Через навык можно сделать это так: "Запомни Алексей набрать 89222222222", спросить "кто Алексей".

## Команды:
- Начните фразу со "что/кто", чтобы получить ответ. Например: "что на дворе"
- Начните фразу с "где/когда/в чем", чтобы найти место, где это что-то лежит. Например: "где трава"
- Скажите "запомни", чтобы добавить новый ответ
- Скажите "команды", чтобы посмотреть примеры
- Можно быстро добавить новый ответ так: "запомни ... находится/лежит/стоит ..."
- Можно удалить последний ответ, сказав "удали/забудь последнее"
- Если надо удалить что-то другое, скажите, например, "удали/забудь на дворе"
- При тестовом запуске доступна команда "демо данные"

## Известные проблемы:
- Нельзя запомнить сразу несколько вещей
- Не умеет понимать временные запоминания, типа "запомни завтра футбол", обязательно должен быть глагол: "запомни завтра будет футбол"

## Проблемные фразы:
- спасибо пока
- надо купить

## Технические особенности
- Сделано на [yandex-dialogs-sdk](https://github.com/fletcherist/yandex-dialogs-sdk), используются commands, scenes, matchers, middlewares из SDK
- Выбор хранилища между MongoDB и Loki (локальное файловое хранилище)
- Выбор сценария на основе простого морфологического разбора
- Система тестирования на основе [сценариев](/static/scenarios.yml), работает на [yandex-dialogs-client](https://github.com/popstas/yandex-dialogs-client) и на [travis](https://travis-ci.org/popstas/yandex-dialogs-whatis)
- Некоторые команды работают только в dev-окружении

## Особенности диалога
- Умеет отвечать на типичные фразы: приветствие, благодарность, оскорбление
- Пытается понять, что пользователь сказал неправильно и подсказать

### AWS Lambda
- Создать/обновить лямбду: `npm run deploy`

У пользователя AWS должны быть права на cloudformation, AWSLambdaFullAccess, IAMFullAccess, AmazonAPIGatewayAdministrator (может можно меньше, но эти работают).

На данный момент на лямбде работать нормально не будет, т.к. сессия yandex-dialogs-sdk хранится в оперативке и не disposable (при желании можно дописать).

## Пожелания к SDK:
- легкий способ вывести многострочный текст с кнопками, simpleReply, [8e68436](https://github.com/popstas/yandex-dialogs-whatis/commit/8e6843652a7ea8cccb2d0a1fb62ed833103e5665)
- мидварь "случайный ответ из списка", replyRandom, [9c33c69](https://github.com/popstas/yandex-dialogs-whatis/commit/9c33c692bc02c6f6f20b61f10e03d195cb00f54a)
