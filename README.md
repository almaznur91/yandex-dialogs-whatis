# yandex-dialogs-whatis

[![Build Status](https://travis-ci.org/popstas/yandex-dialogs-whatis.svg?branch=master)](https://travis-ci.org/popstas/yandex-dialogs-whatis)

Бот отвечает на вопросы и умеет записывать новые ответы.

У каждого пользователя собственная база вопросов и ответов.

По умолчанию запускается на *:2756

## Команды:
- Начните фразу со "что/кто", чтобы получить ответ. Например: "что на дворе"
- Начните фразу с "где/когда/в чем", чтобы найти место, где это что-то лежит. Например: "где трава"
- Скажите "запомни", чтобы добавить новый ответ
- Скажите "команды", чтобы посмотреть примеры
- Можно быстро добавить новый ответ так: "запомни ... находится/лежит/стоит ..."
- Можно удалить последний ответ, сказав "удали/забудь последнее"
- Если надо удалить что-то другое, скажите, например, "удали/забудь на дворе"
- При тестовом запуске доступна команда "демо данные"

## Известные проблемы:
- Нельзя запомнить сразу несколько вещей
- Тупо отвечает на всё нераспознанное базовой справкой, надо предполагать, в чем ошибка и подсказывать юзеру

## Проблемные фразы:
- спасибо пока
- надо купить

## Технические особенности
- Сделано на [yandex-dialogs-sdk](https://github.com/fletcherist/yandex-dialogs-sdk), используются commands, scenes, matchers, middlewares из SDK
- Выбор хранилища между MongoDB и Loki (локальное файловое хранилище)
- Выбор сценария на основе простого морфологического разбора
- Система тестирования на основе [сценариев](/static/scenarios.yml), работает на [yandex-dialogs-client](https://github.com/popstas/yandex-dialogs-client) и на [travis](https://travis-ci.org/popstas/yandex-dialogs-whatis)
- Некоторые команды работают только в dev-окружении

### AWS Lambda
- Создать/обновить лямбду: `npm run deploy`

У пользователя AWS должны быть права на cloudformation, AWSLambdaFullAccess, IAMFullAccess, AmazonAPIGatewayAdministrator (может можно меньше, но эти работают).

На данный момент на лямбде работать нормально не будет, т.к. сессия yandex-dialogs-sdk хранится в оперативке и не disposable (при желании можно дописать).

## Пожелания к SDK:
- легкий способ вывести многострочный текст с кнопками, simpleReply, [8e68436](https://github.com/popstas/yandex-dialogs-whatis/commit/8e6843652a7ea8cccb2d0a1fb62ed833103e5665)
- мидварь "случайный ответ из списка", replyRandom, [9c33c69](https://github.com/popstas/yandex-dialogs-whatis/commit/9c33c692bc02c6f6f20b61f10e03d195cb00f54a)
